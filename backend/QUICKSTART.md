# 快速运行指南(旧版本)

## 立即开始

### 1. 启动完整示例

```bash
cd D:\project\APIGateway\backend
python examples\complete_demo.py
```

你会看到系统启动日志，包括所有组件的初始化信息。

### 2. 发送测试数据（新开终端）

```bash
cd D:\project\APIGateway\backend
python examples\udp_sender.py
```

## 预期效果

### 终端1（网关）输出示例：

```
============================================================
启动模拟HTTP服务器...
模拟HTTP服务器启动在 http://localhost:8888
============================================================
初始化网关管理器...
============================================================
注册帧格式定义...
✓ 帧格式已注册: 温度传感器数据帧
============================================================
注册目标系统...
✓ 目标系统已注册: 正常温度数据系统
✓ 目标系统已注册: 高温报警系统
============================================================
注册路由规则...
✓ 路由规则已注册: 正常温度路由
✓ 路由规则已注册: 高温报警路由
============================================================
创建UDP适配器...
✓ UDP适配器已创建，监听端口: 9999
============================================================
启动网关...
数据处理管道已启动
UDP适配器 'sensor_udp' 启动成功，监听 0.0.0.0:9999
✓ 网关启动成功!
============================================================
【配置摘要】
  UDP监听端口: 9999
  帧格式: 温度传感器数据帧
  路由规则:
    - 温度 ≤ 30℃ -> 正常系统 (http://localhost:8888/api/normal)
    - 温度 > 30℃ -> 报警系统 (http://localhost:8888/api/alert)
============================================================

🚀 系统已就绪！

📡 发送测试数据:
   在另一个终端运行: python examples/udp_sender.py
```

当接收到数据时：

```
[INFO] UDP接收数据: 8 bytes from 127.0.0.1:xxxxx
[INFO] UDP数据解析成功: {'temperature': 25.3, 'humidity': 62.1}
[INFO] 路由消息: 1 个规则匹配, 1 个目标系统
[INFO] [正常温度API] 接收数据: {'temp': 25.3, 'hum': 62.1, 'sensor_type': 'temperature', 'status': 'normal'}

[WARNING] [高温报警API] ⚠️ 收到高温报警: {'temp': 35.2, 'hum': 58.9, 'alert_type': 'high_temperature', 'severity': 'warning', 'sensor_address': '127.0.0.1'}
```

### 终端2（发送器）输出示例：

```
============================================================
UDP传感器数据发送器
============================================================
目标: 127.0.0.1:9999
数据格式: 温度(float32) + 湿度(float32)
============================================================

【场景1】发送正常温度数据（应该路由到正常系统）
[14:23:45] 发送数据: 温度=25.3℃, 湿度=62.1%
[14:23:46] 发送数据: 温度=22.8℃, 湿度=55.4%
[14:23:47] 发送数据: 温度=27.1℃, 湿度=68.2%

【场景2】发送高温数据（应该触发报警系统）
[14:23:50] 发送数据: 温度=35.2℃, 湿度=58.9%
[14:23:51] 发送数据: 温度=38.1℃, 湿度=45.3%
[14:23:52] 发送数据: 温度=33.7℃, 湿度=51.6%

【场景3】发送临界温度数据
[14:23:55] 发送数据: 温度=30.0℃, 湿度=60.0%
[14:23:56] 发送数据: 温度=30.1℃, 湿度=60.0%

============================================================
✓ 所有测试数据已发送
============================================================
```

## 单条命令测试

如果不想运行完整测试脚本，可以用单条命令发送：

```bash
# 发送正常温度（25.5℃）
python -c "import socket, struct; s=socket.socket(socket.AF_INET, socket.SOCK_DGRAM); s.sendto(struct.pack('<ff', 25.5, 60.0), ('127.0.0.1', 9999))"

# 发送高温（35℃）
python -c "import socket, struct; s=socket.socket(socket.AF_INET, socket.SOCK_DGRAM); s.sendto(struct.pack('<ff', 35.0, 65.0), ('127.0.0.1', 9999))"
```

## 停止系统

在网关终端按 `Ctrl+C` 即可优雅停止。

## 验证完整数据流

通过这个示例，你可以验证：

✅ **UDP接收** - 9999端口接收数据
✅ **帧解析** - 将8字节数据解析为temperature和humidity
✅ **路由匹配** - 根据温度值选择目标系统
✅ **数据转换** - 字段映射和新增字段
✅ **HTTP转发** - POST到模拟API服务器
✅ **EventBus** - 所有组件通过EventBus通信

整个流程完全走通！🎉
